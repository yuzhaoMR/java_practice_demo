# guess_number

## 整体需求
实现猜数字的游戏。游戏有四个格子，每个格子有一个0到9的数字，任意两个格子的数字都不一样。你有6次猜测的机会，如果猜对则获胜，否则失败。每次猜测时需依序输入4个数字，程序会根据猜测的情况给出xAxB的反馈，A前面的数字代表位置和数字都对的个数，B前面的数字代表数字对但是位置不对的个数。

例如：答案是1 2 3 4， 那么对于不同的输入，有如下的输出：

Input | Output | Description
--- | --- | --- 
1567 | 1A0B | 1位置正确
--- | --- | --- 
2478 | 0A2B | 2、4位置都不正确
--- | --- | --- 
0324 | 1A2B | 4位置正确，2、3位置不正确
--- | --- | --- 
12 | 输入不正确，重新输入
--- | --- | --- 
1123 | 输入不正确，重新输入
--- | --- | --- 
1234 | 胜出，全中

答案在游戏开始时随机生成。输入只有6次机会，在每次猜测时，程序应给出当前猜测的结果，以及之前所有猜测的数字和结果以供玩家参考。输入界面为控制台（Console），以避免太多与问题无关的界面代码。输入时，用空格分隔数字。

## 任务分解
我们对Guess Number分解的任务为：
1. 随机生成答案
2. 检查输入是否合法
3. 判断每次猜测的结果
4. 记录并显示历史猜测数据
5. 判断游戏结果。判断猜测次数，如果满6次但是未猜对则判负；如果在6次内猜测的4个数字值与位置都正确，则判胜

## 讨论：选择开始的任务 
在分解好任务开始测试驱动开发时，我们应该优先选择哪一个任务？ 选择的标准包括：

1. 任务的依赖性
2. 任务的重要性
从依赖的角度看，并不一定需要优先选择前序任务，因为我们可以使用Mock的方式驱动出当前任务需要依赖的接口，而不用考虑实现。例如，“随机生成答案”任务与“判断每次猜测的结果”任务之间存在前后序的依赖关系，但实现的顺序却并不需要按照此顺序。

对于任务的重要性，主要是判断任务是否整个系统（模块）的核心功能。一个判断标准是确定任务是功能的主要流程还是异常流程。例如任务“检查输入是否合法”即为异常流程，可以考虑后做。

## 测试驱动开发
1. 开始第一个任务
我们认为，任务“判断每次的猜测结果”可以作为起始的核心任务。

2. 任务：判断每次的猜测结果
在进行测试驱动时，选择好任务后，就需要对测试用例进行分析。可以假设该任务就是你要实现的一个完整功能，然后从外部调用的角度去思考用例。这体现为两个方面：

选择测试样本；
驱动承担该职责的对象，根据意图设计接口；
选择测试样本的方法请参考实例化需求。例如，这里可以选择全中或全错等样本。通常情况下，编写的第一个测试应该选择最简单的样本。

## 知识：Specification By Example
由Gojko Adzic的著作Specification By Example（实例化需求），介绍了如何通过实例去分析和沟通需求。它是一组过程模式，可以协助软件产品的变更，确保有效地交付正确的产品。实例化需求的过程分为：

1. 从目标中获取范围
2. 用实例进行描述
3. 精炼需求说明
4. 自动化验证，无须改变需求说明
5. 频繁验证
6. 演进出一个文档系统
更多内容，请参考该书。

注意：单元测试不能针对方法编写测试，而应根据业务编写测试用例。一个测试方法只能做一件事情，代表一个测试样本和一个业务规则。

## 思考：测试驱动开发的驱动力
设计接口是体现测试驱动开发“驱动力”的重要一点。之所以先编写测试，就是希望开发人员站在调用者的角度去思考，即所谓“意图导向编程”。从调用的角度思考，可以驱动我们思考并达到如下目的：

如何命名被测试类以及方法，才能更好地表达设计者的意图，使得测试具有更好的可读性；
被测对象的创建必须简单，这样才符合测试哲学，从而使得设计具有良好的可测试性；
测试使我们只关注接口，而非实现；

## 知识：Given-When-Then模式
在编写测试方法时，应遵循Given-When-Then模式，这种方式描述了测试的准备，期待的行为，以及相关的验收条件。Given-When-Then模式体现了TDD对设计的驱动力：

编写Given时，“驱动”我们思考被测对象的创建，以及它与其他对象的协作；
编写When时，“驱动”我们思考被测接口的方法命名，以及它需要接收的传入参数；考虑行为方式，究竟是命令式还是查询式方法(CQS原则)；
编写Then时，“驱动”我们分析被测接口的返回值；


## 知识：CQS原则
CQS原则，即命令-查询分离原则（Command-Query Separation），是指一个函数要么是一个命令来执行动作，要么是一个查询来给调用者返回数据。但是不能两者都是。

## 知识：命名规则
类命名规则：测试类与被测类的命名应保持一致，通常情况下，测试类的名称为：被测类名称+Test后缀。例如这里的Game类为被测类，则测试类命名为GameTest。

方法命名规则：测试方法应表述业务含义，这样就能使得测试类可以成为文档。测试方法可以足够长，以便于清晰地表述业务。为了更好地辨别方法名表达的含义，ThoughtWorks提倡用Ruby风格的命名方法，即下划线分隔方法的每个单词，而非Java传统的驼峰风格。建议测试方法名以should开头，此时，默认的主语为被测类。例如：

@Test     public void should_return_0A0B_when_no_number_guessed_correctly(){     //...     }

这里的方法可以阅读为：Game should return 0A0B when no number guessed correctly。显然，这是一条描述了业务规则的自然语言。
